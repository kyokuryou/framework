<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="lib_all" name="framework_lib">

    <import file="./build_property.xml"/>

    <target name="lib_clean" description="Prepare for clean build">
        <mkdir dir="${war.web.dirPath}/WEB-INF/lib"/>
        <delete quiet="true">
            <fileset dir="${war.web.dirPath}/WEB-INF/lib">
                <exclude name="${src.jar.name}.jar"/>
                <exclude name="${web.jar.name}.jar"/>
                <exclude name="${sec.jar.name}.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <fileset dir="${lib.build.dirPath}">
                <include name="**"/>
            </fileset>
        </delete>
    </target>
    <target name="lib_conf">
        <tempfile destdir="${lib.build.dirPath}/conf" property="system" suffix=".properties" description="make file"/>

        <concat destfile="${lib.build.dirPath}/conf/system.properties" encoding="utf-8" append="true">
            <path path="${src.meta.dirPath}/conf/system.properties"/>
        </concat>
        <concat destfile="${lib.build.dirPath}/conf/system.properties" encoding="utf-8" append="true">
            <path path="${web.meta.dirPath}/src/conf/system.properties"/>
        </concat>

        <concat destfile="${lib.build.dirPath}/conf/system.properties" encoding="utf-8" append="true">
            <path path="${sec.meta.dirPath}/src/conf/system.properties"/>
        </concat>
    </target>

    <target name="lib_dist" description="Create binary distribution">
        <copy todir="${war.src.dirPath}/conf" overwrite="true">
            <file file="${lib.build.dirPath}/conf/system.properties"/>
        </copy>

        <copy todir="${war.web.dirPath}/WEB-INF/lib" overwrite="true" includeEmptyDirs="no">
            <!-- 主要 -->
            <fileset dir="${lib.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- 数据库连接池 -->
            <fileset dir="${lib.database.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- DB2数据库驱动包 -->
            <!--
            <fileset dir="${lib.database.db2.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            -->
            <!-- mysql数据库驱动包 -->
            <fileset dir="${lib.database.mysql.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- 主要(commons)-->
            <fileset dir="${lib.extend.commons.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>

            <!-- html,xml,js压缩依赖包 -->
            <fileset dir="${lib.extend.compressor.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>

            <!-- flex依赖包 -->
            <!--
            <fileset dir="${lib.extend.flex.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            -->
            <!-- jcaptcha依赖 -->
            <fileset dir="${lib.extend.jcaptcha.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- poi依赖包 -->
            <fileset dir="${lib.extend.poi.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>

            <!-- spring权限-->
            <fileset dir="${lib.extend.security.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- spring(主要)-->
            <fileset dir="${lib.extend.spring.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- springmvc-->
            <fileset dir="${lib.extend.springmvc.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            <!-- xfire依赖包-->
            <!--
            <fileset dir="${lib.extend.xfire.dirPath}">
                <include name="*.jar"/>
                <patternset refid="ignored.files"/>
            </fileset>
            -->
        </copy>
    </target>
    <target name="lib_all" depends="lib_clean,lib_conf,lib_dist"/>
</project>